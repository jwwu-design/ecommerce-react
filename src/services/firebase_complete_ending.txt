  removeProduct = (id) => this.db.collection("products").doc(id).delete();

  // REGISTRATION FORM ACTIONS ------------

  // 取得報名表單範本的下載連結
  getRegistrationFormTemplate = async () => {
    try {
      const templateRef = this.storage.ref("registration-forms/template.docx");
      const downloadURL = await templateRef.getDownloadURL();
      return downloadURL;
    } catch (error) {
      throw new Error("無法取得報名表單範本，請稍後再試。");
    }
  };

  // 上傳使用者填寫的報名表單
  uploadRegistrationForm = async (userId, userName, file) => {
    try {
      const timestamp = new Date().getTime();
      const fileName = ${timestamp}.docx;
      // 使用 userName-userId 格式，方便識別
      // 清理使用者名稱中的特殊字元
      const sanitizedUserName = userName.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_');
      const folderName = ${sanitizedUserName}-;
      const fileRef = this.storage.ref(egistration-forms/submissions//);
      
      const snapshot = await fileRef.put(file);
      const downloadURL = await snapshot.ref.getDownloadURL();
      
      return { downloadURL, fileName, timestamp };
    } catch (error) {
      throw new Error("上傳報名表單失敗，請稍後再試。");
    }
  };

  // 儲存報名表單上傳記錄到 Firestore
  saveRegistrationRecord = async (userId, formData) => {
    try {
      const recordId = this.db.collection("registrations").doc().id;
      await this.db.collection("registrations").doc(recordId).set({
        userId,
        ...formData,
        uploadedAt: new Date().getTime(),
        status: "submitted"
      });
      return recordId;
    } catch (error) {
      throw new Error("儲存報名記錄失敗，請稍後再試。");
    }
  };
}

const firebaseInstance = new Firebase();

export default firebaseInstance;
